
#import "VulnerabilityMap.h"
#import "Globals.h"

@interface VulnerabilityMap ()

@property (nonatomic, weak) TensionMap *   tensionMap;
@property (nonatomic, weak) InfluenceMap * influenceMap;

@end


@implementation VulnerabilityMap


- (id) initWithTension:(TensionMap *)tension influence:(InfluenceMap *)influence {
    if ( ( self = [super init] ) ) {
        self.title = @"Vulnerability";
        _tensionMap = tension;
        _influenceMap = influence;
	}
    
	return self;
}


- (void) update {
    [self clear];

    int w = self.width;

    for ( int y = 0; y < self.height; ++y ) {
        for ( int x = 0; x < self.width; ++x ) {
            int index = y * w + x;
            float tension = [self.tensionMap getValue:x y:y];
            float influence = [self.influenceMap getValue:x y:y];

            // the sum of the values
            float sum = tension - fabs( influence );

            // save
            data[ index ] = sum;

            // new min or max?
            self.max = MAX( self.max, sum );
            self.min = MIN( self.min, sum );
        }
    }

    NSLog( @"max: %f, min: %f", self.max, self.min );
}

@end
